# Phase 5 æ®‹å­˜ã‚¨ãƒ©ãƒ¼åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥æ™‚**: 2025å¹´9æœˆ16æ—¥
**ä½œæ¥­ãƒ•ã‚§ãƒ¼ã‚º**: Phase 5 é‡å¤§å®Ÿè£…ã‚¨ãƒ©ãƒ¼ä¿®æ­£
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: éƒ¨åˆ†å®Œäº†ï¼ˆä¸»è¦ã‚¨ãƒ©ãƒ¼è§£æ±ºæ¸ˆã¿ã€æ®‹å­˜ã‚¨ãƒ©ãƒ¼14ä»¶ï¼‰

## ğŸ“Š ä¿®å¾©å®Œäº†ã‚µãƒãƒªãƒ¼

### âœ… è§£æ±ºæ¸ˆã¿ã‚¨ãƒ©ãƒ¼ï¼ˆPhase 5ã§ä¿®æ­£å®Œäº†ï¼‰

| å„ªå…ˆåº¦ | ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ— | ä¿®æ­£å†…å®¹ | å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«æ•° |
|--------|-------------|----------|---------------|
| Critical | ServiceLocator using directives | `using asterivo.Unity60.Core;` è¿½åŠ  | 3ãƒ•ã‚¡ã‚¤ãƒ« |
| Critical | AlertLevel enum mapping | Core.Data.AlertLevelå€¤ï¼ˆUnaware/Suspicious/Alert/Combatï¼‰ã«æ­£ã—ããƒãƒƒãƒ”ãƒ³ã‚° | 1ãƒ•ã‚¡ã‚¤ãƒ« |
| High | ServiceLocator API | `Instance.Register` â†’ `RegisterService` ä¿®æ­£ | 1ãƒ•ã‚¡ã‚¤ãƒ« |
| Medium | Camera namespace conflict | `Camera.main` â†’ `UnityEngine.Camera.main` æ˜ç¤ºåŒ– | 1ãƒ•ã‚¡ã‚¤ãƒ« |

**åˆè¨ˆè§£æ±ºã‚¨ãƒ©ãƒ¼**: ç´„20ä»¶ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£

## âš ï¸ æ®‹å­˜ã‚¨ãƒ©ãƒ¼è©³ç´°åˆ†æ

### ğŸ”´ Critical Level - Assemblyå‚ç…§å•é¡Œ (14ä»¶)

#### ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: `CS0234 - The type or namespace name 'IStealthMechanicsService' does not exist`

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `HidingSpotInteractionCommand.cs` (4ç®‡æ‰€)
- `StealthMechanics.cs` (1ç®‡æ‰€)
- `StealthTemplateManager.cs` (2ç®‡æ‰€)

**å…·ä½“çš„ã‚¨ãƒ©ãƒ¼**:
```csharp
// Line 298-307: HidingSpotInteractionCommand.cs
var stealthController = ServiceLocator.GetService<asterivo.Unity60.Core.Services.IStealthMechanicsService>();
//                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//                                                 CS0234: 'IStealthMechanicsService' does not exist
```

**å•é¡Œåˆ†æ**:
1. **Assembly Definitionå‚ç…§ä¸æ•´åˆ**: `asterivo.Unity60.Features.Templates.Stealth.asmdef`ãŒ`asterivo.Unity60.Core.Services`ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®IStealthMechanicsServiceãŒè¦‹ã¤ã‹ã‚‰ãªã„
2. **åå‰ç©ºé–“ä¸ä¸€è‡´**: å®Ÿéš›ã®IStealthMechanicsServiceãŒç•°ãªã‚‹åå‰ç©ºé–“ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§
3. **Interfaceå®Ÿè£…ä¸è¶³**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è‡ªä½“ãŒæœªå®Ÿè£…ã¾ãŸã¯ä¸å®Œå…¨

**æ¨å¥¨è§£æ±ºç­–**:
```csharp
// Option 1: å®Œå…¨ä¿®é£¾åã§ã®å‚ç…§
using asterivo.Unity60.Core.Services;  // å®Ÿéš›ã®åå‰ç©ºé–“ã‚’ç¢ºèª
var stealthController = ServiceLocator.GetService<IStealthMechanicsService>();

// Option 2: ä¸€æ™‚çš„å›é¿ï¼ˆnullè¨±å®¹ï¼‰
var stealthController = ServiceLocator.GetService<IStealthMechanicsService>();
if (stealthController != null) {
    // å‡¦ç†ç¶šè¡Œ
} else {
    Debug.LogWarning("StealthMechanicsService not available");
}
```

### ğŸŸ¡ High Level - åå‰ç©ºé–“ã‚¨ãƒ©ãƒ¼ (2ä»¶)

#### ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: `CS0234 - The type or namespace name 'DetectionType' does not exist`

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `StealthEnvironmentManager.cs` (Line 216, 360)

**å…·ä½“çš„ã‚¨ãƒ©ãƒ¼**:
```csharp
// Line 216: StealthEnvironmentManager.cs
asterivo.Unity60.Features.Templates.Stealth.DetectionType detectionType;
//                                             ^^^^^^^^^^^^
//                                             CS0234: 'DetectionType' does not exist
```

**å•é¡Œåˆ†æ**:
1. **DetectionTypeå®šç¾©ç¼ºå¤±**: `asterivo.Unity60.Features.Templates.Stealth`åå‰ç©ºé–“ã«DetectionTypeãŒå­˜åœ¨ã—ãªã„
2. **æ­£ã—ã„å ´æ‰€**: DetectionTypeãŒ`asterivo.Unity60.Core.Data`ã«ç§»å‹•ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§

**æ¨å¥¨è§£æ±ºç­–**:
```csharp
// æ­£ã—ã„åå‰ç©ºé–“å‚ç…§ã‚’è¿½åŠ 
using asterivo.Unity60.Core.Data;

// ã¾ãŸã¯å®Œå…¨ä¿®é£¾åã§ä½¿ç”¨
asterivo.Unity60.Core.Data.DetectionType detectionType;
```

### ğŸŸ  Medium Level - Missing Implementation (10ä»¶)

#### ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: `CS1061 - does not contain a definition for`

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `StealthTemplateValidator.cs` (8ä»¶)
- `StealthGameplayManager.cs` (2ä»¶)

**å…·ä½“çš„ã‚¨ãƒ©ãƒ¼**:
```csharp
// StealthTemplateValidator.cs - Missing Properties
config.templateName         // CS1061: 'templateName' not found
config.templateVersion       // CS1061: 'templateVersion' not found
config.targetGameplayDuration // CS1061: 'targetGameplayDuration' not found
config.estimatedLearningTime  // CS1061: 'estimatedLearningTime' not found
config.MechanicsConfig       // CS1061: 'MechanicsConfig' not found
config.AIConfig              // CS1061: 'AIConfig' not found
config.AudioConfig           // CS1061: 'AudioConfig' not found

// StealthGameplayManager.cs - Missing Methods
stealthUI.UpdateGlobalAlertLevel() // CS1061: 'UpdateGlobalAlertLevel' not found
```

**å•é¡Œåˆ†æ**:
1. **ScriptableObjectè¨­è¨ˆä¸å®Œå…¨**: `StealthTemplateConfig`ã«å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæœªå®Ÿè£…
2. **UI Manager APIä¸æ•´åˆ**: `StealthUIManager`ã«ãƒ¡ã‚½ãƒƒãƒ‰ãŒæœªå®Ÿè£…
3. **è¨­è¨ˆä»•æ§˜ã¨ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã®ã‚®ãƒ£ãƒƒãƒ—**: è¦ä»¶å®šç¾©ã•ã‚ŒãŸAPIãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

**æ¨å¥¨è§£æ±ºç­–**:
```csharp
// StealthTemplateConfig.cs ã«ä¸è¶³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
[CreateAssetMenu(menuName = "Stealth/Template Config")]
public class StealthTemplateConfig : ScriptableObject
{
    [Header("Template Information")]
    public string templateName = "Stealth Template";
    public string templateVersion = "1.0.0";

    [Header("Gameplay Settings")]
    public float targetGameplayDuration = 30.0f; // minutes
    public float estimatedLearningTime = 15.0f;  // minutes

    [Header("Component Configs")]
    public StealthMechanicsConfig MechanicsConfig;
    public StealthAIConfig AIConfig;
    public StealthAudioConfig AudioConfig;
}

// StealthUIManager.cs ã«ä¸è¶³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
public void UpdateGlobalAlertLevel(float alertLevel)
{
    // Implementation needed
    Debug.Log($"Global alert level updated to: {alertLevel}");
}
```

### ğŸ”µ Low Level - Type Conversion (2ä»¶)

#### ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: `CS1503 - Argument cannot convert`

**å…·ä½“çš„ã‚¨ãƒ©ãƒ¼**:
```csharp
// StealthGameplayManager.cs:448
CompleteObjective(objective); // Cannot convert 'StealthMissionObjective' to 'string'

// StealthTemplateManager.cs:167
ServiceLocator.RegisterService<IStealthMechanicsService>(stealthMechanics);
// Cannot convert 'StealthMechanics' to 'IStealthMechanicsService'
```

**æ¨å¥¨è§£æ±ºç­–**:
```csharp
// Type conversion fixes
CompleteObjective(objective.ObjectiveName); // Extract string property

// Interface implementation verification
public class StealthMechanics : MonoBehaviour, IStealthMechanicsService
{
    // Ensure proper interface implementation
}
```

## ğŸ“‹ ä¿®å¾©å„ªå…ˆé †ä½ & ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

### Phase 5A: Critical Assemblyä¿®å¾© (æ¨å®šå·¥æ•°: 2-3æ™‚é–“)

1. **IStealthMechanicsService Assemblyå®šç¾©ä¿®å¾©**
   - Core.Services assembly definitionã®ç¢ºèªã¨ä¿®æ­£
   - Interfaceå®šç¾©ã®å®Œå…¨æ€§æ¤œè¨¼
   - ä¾å­˜é–¢ä¿‚ã®å†æ§‹ç¯‰

2. **DetectionTypeåå‰ç©ºé–“çµ±ä¸€**
   - Core.Dataã¸ã®æ­£ã—ã„å‚ç…§è¿½åŠ 
   - Featureå±¤ã§ã®é‡è¤‡å®šç¾©å‰Šé™¤

### Phase 5B: Missing Implementationè¿½åŠ  (æ¨å®šå·¥æ•°: 3-4æ™‚é–“)

1. **StealthTemplateConfigæ‹¡å¼µ**
   - å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£8ä»¶ã®å®Ÿè£…
   - ScriptableObject Inspector UIæœ€é©åŒ–

2. **StealthUIManager APIå®Œæˆ**
   - UpdateGlobalAlertLevel ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
   - UIæ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ

### Phase 5C: Typeå®‰å…¨æ€§å‘ä¸Š (æ¨å®šå·¥æ•°: 1-2æ™‚é–“)

1. **Interfaceå®Ÿè£…ç¢ºèª**
   - StealthMechanics â†’ IStealthMechanicsServiceå®Ÿè£…æ¤œè¨¼
   - Type conversionä¿®æ­£

2. **Final Integration Test**
   - å…¨ã‚¨ãƒ©ãƒ¼è§£æ±ºå¾Œã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¤œè¨¼
   - åŸºæœ¬æ©Ÿèƒ½å‹•ä½œç¢ºèª

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™

### å®Œäº†æ¡ä»¶
- [ ] ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ 0ä»¶é”æˆ
- [ ] è­¦å‘Šãƒ¬ãƒ™ãƒ« 5ä»¶ä»¥ä¸‹
- [ ] åŸºæœ¬ã‚¹ãƒ†ãƒ«ã‚¹æ©Ÿèƒ½å‹•ä½œç¢ºèª
- [ ] NPCVisualSensorçµ±åˆå‹•ä½œç¢ºèª

### å“è³ªæŒ‡æ¨™
- [ ] Assemblyå‚ç…§æ•´åˆæ€§100%
- [ ] Interfaceå®Ÿè£…å®Œå…¨æ€§100%
- [ ] ScriptableObjectè¨­å®šå®Œå…¨æ€§100%

## ğŸ”§ æŠ€è¡“ãƒ¡ãƒ¢

### Assembly Definitionæ§‹é€ 
```
asterivo.Unity60.Core
â”œâ”€â”€ asterivo.Unity60.Core.Services (IStealthMechanicsService)
â””â”€â”€ asterivo.Unity60.Core.Data (DetectionType, AlertLevel)

asterivo.Unity60.Features.Templates.Stealth
â”œâ”€â”€ References: asterivo.Unity60.Core.Services âœ…
â””â”€â”€ References: asterivo.Unity60.Core.Data âœ…
```

### ServiceLocator API Pattern
```csharp
// ç¾åœ¨ã®æ­£ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ (é™çš„ãƒ¡ã‚½ãƒƒãƒ‰)
ServiceLocator.RegisterService<T>(service);
var service = ServiceLocator.GetService<T>();

// æ—§ãƒ‘ã‚¿ãƒ¼ãƒ³ (å‰Šé™¤æ¸ˆã¿)
ServiceLocator.Instance.Register<T>(service); // âŒ Instanceç„¡ã—
```

---

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Phase 5A Critical Assemblyä¿®å¾©ã‹ã‚‰é–‹å§‹æ¨å¥¨
**æƒ³å®šå®Œäº†**: 2-3ã‚»ãƒƒã‚·ãƒ§ãƒ³ (6-9æ™‚é–“)
**ãƒªã‚¹ã‚¯**: Assemblyå®šç¾©æ ¹æœ¬å•é¡ŒãŒè¤‡é›‘ãªå ´åˆã€è¿½åŠ èª¿æŸ»æ™‚é–“ãŒå¿…è¦
